# Understanding Swift Performance

## ğŸ“Œ Choosing the Right Abstraction Mechanism

ìŠ¤ìœ„í”„íŠ¸ì˜ ì—¬ëŸ¬ íƒ€ì…ë“¤ ì¤‘ ì–´ë–¤ íƒ€ì…ì„ ê³¨ë¼ ì¨ì•¼ í• ê¹Œ?
`ëª¨ë¸ë§`ê³¼ `ì„±ëŠ¥`ì„ ê³ ë ¤í•˜ì—¬ íƒ€ì…ì„ ì„ íƒí•  ê²ƒ.

ì„±ëŠ¥ì—ì„œ ì´ì•¼ê¸°í•  3ê°€ì§€ : `Allocation` `Reference Counting` `Method Dispatch`

![](https://i.imgur.com/JjjTvwm.png)

ì´ ì„¸ ê°€ì§€ ê´€ì ì—ì„œ íƒ€ì…ì˜ ì„±ëŠ¥ì„ íŒë‹¨í•˜ê²Œ ëœë‹¤.

- Allocation: ë©”ëª¨ë¦¬ê°€ stack ë˜ëŠ” heap ì˜ì—­ ì¤‘ ì–´ë””ì— í• ë‹¹ ë˜ëŠ”ì§€
- Reference Counting: ì°¸ì¡° ê´€ë¦¬
- Method Dispatch: ì–´ë–¤ ë©”ì„œë“œê°€ ì‹¤í–‰ë˜ì–´ì•¼ í•˜ëŠ”ì§€ë¥¼ ì•Œì•„ë‚´ëŠ” ë¶€ë¶„

ìš°ì¸¡ìœ¼ë¡œ ê°ˆ ìˆ˜ë¡ ì„±ëŠ¥ì´ ì¢‹ì§€ ì•ŠìŒì„ ë‚˜íƒ€ë‚¸ë‹¤.

## ğŸ“Œ Allocation

### Stack vs Heap

Stack

- Stackì€ ì»´íŒŒì¼ íƒ€ì„ì— ê·¸ í¬ê¸°ê°€ ì •í•´ì§„ë‹¤
- Stackì€ ë©”ëª¨ë¦¬ í• ë‹¹ì„ ìœ„í•´ stack í¬ì¸í„°ë¥¼ ê°ì†Œì‹œí‚¤ê³ , ë©”ëª¨ë¦¬ í•´ì œë¥¼ ìœ„í•´ stack í¬ì¸í„°ë¥¼ ì¦ê°€ì‹œí‚¤ë©´ ë˜ëŠ” ë‹¨ìˆœí•œ êµ¬ì¡°ì´ë‹¤

Heap

- Heapì€ í¬ê¸°ê°€ ëŸ°íƒ€ì„ì— ê²°ì •ëœë‹¤
- Heapì€ ë©”ëª¨ë¦¬ì— í• ë‹¹í•˜ê¸° ìœ„í•´ ì‚¬ìš©í•˜ì§€ ì•Šì€ ë¹ˆ ë©”ëª¨ë¦¬ ë¸”ë¡ì„ ì°¾ì•„ì•¼ í•˜ëŠ” ë¹„ìš©ì´ ìˆë‹¤. ë˜í•œ í•´ì œë¥¼ ìœ„í•´ ë©”ëª¨ë¦¬ ë¸”ë¡ì„ ë‹¤ì‹œ ì‚½ì…í•´ì•¼ í•˜ëŠ” ê³¼ì •ì´ ìˆë‹¤.
- ë™ì ìœ¼ë¡œ í• ë‹¹/í•´ì œê°€ ë˜ê¸° ë•Œë¬¸ì— thread-safeë¥¼ ë³´ì¥í•˜ê¸° ìœ„í•œ ì˜¤ë²„í—¤ë“œê°€ ì¡´ì¬í•œë‹¤

### Structì™€ Classì˜ Allocation

#### Struct
![](https://i.imgur.com/fMLxZqv.png)

Pointë¼ëŠ” êµ¬ì¡°ì²´ê°€ ìˆê³ , point1ì„ point2ì— í• ë‹¹í•˜ë©´ ë³µì‚¬ëœ ëª¨ìŠµì„ ë³¼ ìˆ˜ ìˆë‹¤.
ê°™ì€ ì¸ìŠ¤í„´ìŠ¤ê°€ ì•„ë‹ˆê³  ê°’ë§Œ ê°™ì€ ë³µì‚¬ëœ ì¸ìŠ¤í„´ìŠ¤ì´ê¸° ë•Œë¬¸ì— 

![](https://i.imgur.com/VLfO2dQ.png)

point2ì˜ xì˜ ê°’ì„ ë°”ê¿¨ì„ ë•Œ point1ì—ëŠ” ì˜í–¥ì´ ì—†ëŠ” ê²ƒì„ ë³¼ ìˆ˜ ìˆë‹¤.

#### Class

ë˜‘ê°™ì€ Pointê°€ classë¡œ êµ¬í˜„ë˜ì–´ ìˆë‹¤.
ì°¸ì¡° íƒ€ì…ì˜ ë°ì´í„°ëŠ” Heap ì˜ì—­ì— í• ë‹¹ë˜ì§€ë§Œ, Stackì—ë„ Heapì„ ê°€ë¦¬í‚¤ëŠ” ì£¼ì†Œê°’ì„ ì €ì¥í•œë‹¤.

point1ì„ point2ì— í• ë‹¹ì£¼ë©´ ì°¸ì¡° íƒ€ì…ì´ê¸° ë•Œë¬¸ì— ë™ì¼í•œ heap ë©”ëª¨ë¦¬ ì£¼ì†Œë¥¼ ê°€ë¦¬í‚¤ê²Œ ëœë‹¤.

![](https://i.imgur.com/2VzYMqZ.png)

ê·¸ë˜ì„œ point2ì˜ xê°’ì„ 5ë¡œ ë°”ê¾¸ë©´ point1ì˜ xë„ 5ë¡œ ë°”ë€Œê²Œ ëœë‹¤.

structì™€ classì˜ ì„±ëŠ¥ì„ ê·¸ë¦¼ìœ¼ë¡œ ë¹„êµí•´ë³´ë©´ ì•„ë˜ì™€ ê°™ë‹¤

![](https://i.imgur.com/Zva0Djm.png)

![](https://i.imgur.com/uIBU3xH.png)

ìœ„ ê·¸ë¦¼ì„ ë³´ë©´ structê°€ classë³´ë‹¤ ì„±ëŠ¥ì´ ë›°ì–´ë‚œë°, ì–´ë–»ê²Œ ê°œì„ ì„ í•  ìˆ˜ ìˆì„ê¹Œ?

![](https://i.imgur.com/NvZk9dp.png)

ë”•ì…”ë„ˆë¦¬ íƒ€ì…ì¸ cacheì˜ í‚¤ëŠ” String íƒ€ì…ì´ë‹¤.
Stringì€ structë¡œ êµ¬í˜„ë˜ì–´ ìˆì§€ë§Œ, í¬ê¸°ê°€ ë™ì ìœ¼ë¡œ ë³€í•˜ê¸° ë•Œë¬¸ì— ì»´íŒŒì¼ íƒ€ì„ì— ê·¸ í¬ê¸°ë¥¼ ì•Œ ìˆ˜ ì—†ì–´ heap ì˜ì—­ì„ ì‚¬ìš©í•œë‹¤.
ì´ë•Œ Stringì„ ì‚¬ìš©í•˜ëŠ” ê²ƒì´ ì•„ë‹ˆë¼, íƒ€ì…ì„ ë§Œë“¤ì–´ì„œ í•´ê²°í•´ë³¼ ìˆ˜ ìˆë‹¤.

![](https://i.imgur.com/OPX51Au.png)

enumìœ¼ë¡œ êµ¬í˜„ë˜ì–´ ìˆëŠ” í”„ë¡œí¼í‹°ë¡œ êµ¬ì„±ëœ structë¥¼ ë§Œë“¤ì–´ keyë¡œ í™œìš©í•´ String ì‚¬ìš©ì„ ê°œì„ í•  ìˆ˜ ìˆë‹¤.

## ğŸ“Œ Reference Counting

### Class

![](https://i.imgur.com/8jk7EK4.png)

ì¸ìŠ¤í„´ìŠ¤ë¥¼ í• ë‹¹í•˜ê³ , ì‚¬ìš©ì„ ì™„ë£Œí•˜ëŠ” ì‚¬ì´ì— retainê³¼ release ì½”ë“œê°€ í˜¸ì¶œë˜ëŠ” ê²ƒì„ ë³¼ ìˆ˜ ìˆê³ , Pointì˜ í”„ë¡œí¼í‹°ë¡œ refCountê°€ í”„ë¡œí¼í‹°ë¡œ ì¡´ì¬ í•œë‹¤.
point1ì„ point2ì— í• ë‹¹í•˜ë©´, retainì´ ì‹¤í–‰ë˜ê¸° ë•Œë¬¸ì— refCountëŠ” 1ì´ ë”í•´ì ¸ 2ê°€ ëœë‹¤.

![](https://i.imgur.com/5XZuyBw.png)

point1ê³¼ point2ê°€ ì‚¬ìš©ì„ ë§ˆì¹˜ê³  refCountê°€ 0ì´ ë˜ë©´ ,
ë” ì´ìƒ í•„ìš”í•˜ì§€ ì•Šì€ ê²ƒìœ¼ë¡œ ì¸ì‹í•˜ê³  ë©”ëª¨ë¦¬ì—ì„œ í•´ì œí•œë‹¤.
![](https://i.imgur.com/ooRiMwE.png)

stackê³¼ heap ì˜ì—­ì—ì„œ ëª¨ë‘ ë©”ëª¨ë¦¬ í•´ì œëœë‹¤.

### Struct

structëŠ” ê¸°ë³¸ì ìœ¼ë¡œ ì°¸ì¡°ë¥¼ ê°€ì§€ì§€ ì•Šê¸° ë•Œë¬¸ì— ì°¸ì¡° ì¹´ìš´íŠ¸ë„ ê°€ì§€ì§€ ì•Šì§€ë§Œ, structê°€ ë‚´ë¶€ì ìœ¼ë¡œ ì°¸ì¡° íƒ€ì…ì„ ê°€ì§€ëŠ” ê²½ìš°ì—ëŠ” ì°¸ì¡° ì¹´ìš´íŠ¸ë¥¼ ë³´ìœ í•˜ê²Œ ëœë‹¤.
![](https://i.imgur.com/svl3L2S.png)

ìœ„ Labelì€ struct ì´ì§€ë§Œ, textëŠ” String íƒ€ì…ì´ë©° (heapì— í• ë‹¹), UIFontëŠ” í´ë˜ìŠ¤ì´ê¸° ë•Œë¬¸ì— referenceë¥¼ ê°€ì§€ê²Œ ëœë‹¤.
ê·¸ë˜ì„œ Labelì˜ ì¸ìŠ¤í„´ìŠ¤ë¥¼ ìƒì„±í•˜ëŠ” ì‹œì ì— ì°¸ì¡°ê°€ í•˜ë‚˜ ìƒê¸°ê²Œ ë˜ê³ , 

![](https://i.imgur.com/YJ8nMLM.png)

label1ì„ ë³µì‚¬í•´ì„œ label2 ì¸ìŠ¤í„´ìŠ¤ë¥¼ ë§Œë“¤ ë•Œì—ë„ ì´ì „ì— ìƒì„±ëœ ì£¼ì†Œë¥¼ ê°€ë¦¬í‚¤ëŠ” ì°¸ì¡°ê°€ ìƒê¸°ê²Œ ëœë‹¤.
label1ì„ ë³µì‚¬í•˜ë©´ í”„ë¡œí¼í‹° ë‘ ê°œ ëª¨ë‘ reference countê°€ ì¦ê°€í•˜ê²Œ ëœë‹¤. 
ê·¸ë ‡ê¸° ë•Œë¬¸ì— struct ë‚´ì— ì°¸ì¡° íƒ€ì…ì´ ì¡´ì¬í•  ê²½ìš°, ì°¸ì¡° íƒ€ì…ì˜ í”„ë¡œí¼í‹°ê°€ ë§ì„ ìˆ˜ë¡ ì„±ëŠ¥ì´ ë–¨ì–´ì§„ë‹¤.

#### ğŸ§ ì˜ˆì‹œ: êµ¬ì¡°ì²´ í”„ë¡œí¼í‹°ê°€ RC ë°œìƒì‹œí‚¤ë©´ ì–´ë–»ê²Œ í•´ê²°?
mimetype: ex. png, jpg
* ë¬¸ì œ
![](https://i.imgur.com/FsII0Y5.png)

* í•´ê²°
![](https://i.imgur.com/D2YJzNA.png)

UUIDëŠ” 128bit random IDì¸ë°, êµ¬ì¡°ì²´ì— ë°”ë¡œ ì €ì¥í•  ìˆ˜ ìˆë‹¤.
ì´ë¥¼ í†µí•´ Stringë³´ë‹¤ type safety(ì§ UUIDë§Œ, IDì˜ ì˜ë¯¸ê°€ ìˆëŠ” ê²ƒë§Œ ë“¤ì–´ì˜´)ê°€ ë³´ì¥ëœë‹¤.

indirectly store in heap! í•´ê²°: enum íƒ€ì…
![](https://i.imgur.com/ghdbDcF.png)


![](https://i.imgur.com/TGxJHLI.png)

![](https://i.imgur.com/M2Azq8p.png)

## ğŸ“Œ Method Dispatch

### Static Method Dispatch

ì–´ë–¤ ë©”ì„œë“œ êµ¬í˜„ë¶€ë¥¼ ì‹¤í–‰í•´ì•¼ í•˜ëŠ”ì§€ ì•Œê³  ìˆê¸° ë•Œë¬¸ì—, ëŸ°íƒ€ì„ì— ë°”ë¡œ êµ¬í˜„ë¶€ë¡œ ì´ë™í•  ìˆ˜ ìˆë‹¤.
ì¸ë¼ì´ë‹ìœ¼ë¡œ ì»´íŒŒì¼ëŸ¬ì˜ ìµœì í™”ê°€ ê°€ëŠ¥í•˜ë‹¤.
![](https://i.imgur.com/Zjb8NZ7.png)

![](https://i.imgur.com/aSymqaB.png)

drawAPointë¥¼ ì‹¤í–‰í•  ë•Œ Point.draw()ì˜ êµ¬í˜„ë¶€ë¡œ ëŒ€ì²´í•  ìˆ˜ ìˆë‹¤.

### Dynamic Method Dispatch

ëŸ°íƒ€ì„ë§ˆë‹¤ v-tableì„ í†µí•´ ë©”ì„œë“œ êµ¬í˜„ë¶€ë¥¼ ì°¾ê²Œ ëœë‹¤. ê·¸ ì´í›„ êµ¬í˜„ë¶€ë¡œ ì´ë™í•˜ì—¬ ë©”ì„œë“œë¥¼ ì‹¤í–‰í•˜ê²Œ ëœë‹¤. ê·¸ë ‡ê¸° ë•Œë¬¸ì— ì¸ë¼ì´ë‹ì´ ì–´ë ¤ì›Œì§„ë‹¤.
=> private, final í‚¤ì›Œë“œë¥¼ ì´ìš©í•˜ì—¬ ìƒì†ì´ ë˜ì§€ ì•ŠìŒì„ ë‚˜íƒ€ë‚´ë©´ static dispatchë¡œ ì‹¤í–‰ë  ìˆ˜ë„ ìˆë‹¤.

ê·¸ëŸ¼ Dynamic Dispatchë¥¼ ì‚¬ìš©í•˜ëŠ” ì´ìœ ëŠ”?? ë‹¤í˜•ì„± (Polymorphism) ë•Œë¬¸

V-Tableì€ ìˆ˜ì§ ìƒì† ê´€ê³„ë¥¼ í¬í•¨í•˜ëŠ” í…Œì´ë¸”ë¡œ, ë©”ì„œë“œ ì˜¤ë²„ë¼ì´ë”©ì— ë”°ë¼ ì‹¤í–‰ ì‹œì ì— ì–´ë–¤ ë©”ì„œë“œë¥¼ ì‹¤í–‰í• ì§€ ê²°ì •í•˜ëŠ” dynamic dispatchë¥¼ ì§€ì›í•˜ê¸° ìœ„í•´ ì‚¬ìš©ë˜ëŠ” ë©”ì»¤ë‹ˆì¦˜ì´ë‹¤.

ìƒì†ì„ í•˜ë©´ ë©”ì„œë“œë¥¼ ì¬ì •ì˜í•  ìˆ˜ ìˆê²Œ ë˜ëŠ”ë°, ì´ë•Œ ê° ë©”ì„œë“œì˜ êµ¬í˜„ë¶€ê°€ ë‹¬ë¼ì§€ê¸° ë•Œë¬¸ì— ì»´íŒŒì¼ëŸ¬ëŠ” ì–´ë–¤ ë©”ì„œë“œì˜ êµ¬í˜„ë¶€ë¡œ ì´ë™í•´ì•¼ í•˜ëŠ”ì§€ ëª¨ë¥´ëŠ” ìƒí™©ì´ ì˜¨ë‹¤.
![](https://i.imgur.com/ifUK4gf.png)

![](https://i.imgur.com/xgOhWwI.png)

d.draw()ì—ì„œ Lineì˜ draw()ë¥¼ ì‹¤í–‰í•´ì•¼ í•˜ëŠ”ì§€, Pointì˜ draw()ë¥¼ ì‹¤í–‰í•´ì•¼ í•˜ëŠ”ì§€ ì•Œ ìˆ˜ ì—†ì„ ë•Œ, ì»´íŒŒì¼ëŸ¬ëŠ” ì–´ë–¤ drawë¥¼ í˜¸ì¶œí•´ì•¼ í•˜ëŠ”ì§€ ì–´ë–»ê²Œ ê²°ì •í• ê¹Œ?
ì»´íŒŒì¼ëŸ¬ëŠ” ê·¸ class íƒ€ì…ì˜ ì •ë³´ë¥¼ static memoryì— ì €ì¥í•˜ê³ , ì‹¤ì œë¡œ drawë¥¼ í˜¸ì¶œí•  ë•Œ vtableì„ ì¡°íšŒí•œë‹¤.
ê·¸ë¦¬ê³  ì‹¤í–‰í•˜ê¸°ì— ì í•©í•œ draw() ë©”ì„œë“œë¥¼ ì°¾ê³ , íŒŒë¼ë¯¸í„°ë¡œ ì‹¤ì œ ì¸ìŠ¤í„´ìŠ¤ë¥¼ ì „ë‹¬í•œë‹¤.

## ğŸ“Œ Protocol Types

### ìƒì†ì´ë‚˜ reference semanticsê°€ ì•„ë‹Œ ë‹¤í˜•ì„± (Struct + Protocol)

![](https://i.imgur.com/IKrnHtE.png)

Pointì™€ Lineì€ êµ¬ì¡°ì²´ì´ê¸° ë•Œë¬¸ì— ê³µí†µ ìƒì† ê´€ê³„ê°€ ì•„ë‹ˆë‹¤.
ë”°ë¼ì„œ vtableì„ ì¡°íšŒí•˜ì§€ ì•ŠëŠ”ë°, ì»´íŒŒì¼ ì‹œì ì— ì–´ë–¤ draw()ê°€ í˜¸ì¶œë˜ì–´ì•¼ í• ì§€ë„ ëª¨ë¥´ëŠ” ìƒí™©.
=> Protocol Witness Table

pwtì˜ ì—”íŠ¸ë¦¬ëŠ” í•´ë‹¹ íƒ€ì…ì˜ êµ¬í˜„ì— ì—°ê²°(link)ëœë‹¤.
![](https://i.imgur.com/rKwmZ1X.png)

ê·¸ëŸ°ë° [Drawable] ë°°ì—´ì—ì„œ ì–´ë–»ê²Œ pwt í…Œì´ë¸”ë¡œ ì´ë™í•  ìˆ˜ ìˆì„ê¹Œ?

![](https://i.imgur.com/QShQbNj.png)

PointëŠ” í”„ë¡œí¼í‹°ê°€ 2ê°œ, Lineì€ í”„ë¡œí¼í‹°ê°€ 4ê°œ ìˆì–´ì„œ ì‚¬ì´ì¦ˆê°€ ë‹¤ë¥¸ë°,
ë°°ì—´ì€ ê³ ì •ëœ offsetì— ìš”ì†Œë¥¼ ì €ì¥í•˜ë ¤ê³  í•œë‹¤.
ì´ëŸ´ ë•Œ SwiftëŠ” Existential Containerë¼ëŠ” íŠ¹ìˆ˜í•œ storage layoutì„ ì‚¬ìš©í•œë‹¤.

### Existential Container

![](https://i.imgur.com/r3A2agY.png)

Existential ContainerëŠ” valueBuffer + vwt + pwtë¡œ ë˜ì–´ ìˆë‹¤.
Existential Containerì˜ ì²˜ìŒì—ëŠ” 3ê°œê°€ valueBufferìš©ìœ¼ë¡œ ì˜ˆì•½ ë˜ì–´ ìˆë‹¤.

ê·¸ë˜ì„œ Pointì™€ ê°™ì´ ê°’ì´ 2ê°œë§Œ í•„ìš”í•˜ë©´
![](https://i.imgur.com/y1Od8aR.png)

valueBufferì— ë“¤ì–´ê°ˆ ìˆ˜ ìˆë‹¤.

í•˜ì§€ë§Œ Lineì€ ê°’ì´ 4ê°œê°€ í•„ìš”í•˜ê³ , ì´ëŸ° í° íƒ€ì…ì€ Heapì— ë©”ëª¨ë¦¬ë¥¼ í• ë‹¹í•˜ê³ , í•´ë‹¹ ë©”ëª¨ë¦¬ì— ëŒ€í•œ í¬ì¸í„°ë¥¼ Existential Containerì— ì €ì¥í•œë‹¤.

![](https://i.imgur.com/qBR0v2A.png)

ì´ë ‡ê²Œ ë˜ë©´ Pointì™€ Lineì´ ë‹¤ë¥¸ ë°©ì‹ìœ¼ë¡œ ì €ì¥ë˜ê¸° ë•Œë¬¸ì— Existential ContainerëŠ” ì´ ì°¨ì´ë¥¼ ê´€ë¦¬í•  í•„ìš”ê°€ ìˆë‹¤.
=> VWT (Value Witness Table)

### Value Witness Table (VWT)

: valueì˜ lifetimeì„ ê´€ë¦¬í•˜ë©°, íƒ€ì…ë§ˆë‹¤ Value Witness Tableì„ ê°–ê³  ìˆë‹¤.
(Pointë„, Lineë„ VWTê°€ ìˆë‹¤)

1ï¸âƒ£ allocate
![](https://i.imgur.com/CZllRb5.png)

í”„ë¡œí† ì½œ íƒ€ì…ì˜ ë¡œì»¬ ë³€ìˆ˜ì˜ lifetimeì´ ì‹œì‘ë  ë•Œ, SwiftëŠ” VWTì˜ allocate í•¨ìˆ˜ë¥¼ í˜¸ì¶œí•œë‹¤
(Lineì€ Existential Containerì— ë“¤ì–´ë§ì§€ ì•Šê¸° ë•Œë¬¸ì— Heap ë©”ëª¨ë¦¬ í• ë‹¹ í•„ìš”)
allocate í•¨ìˆ˜ ì•ˆì—ì„œ Heapì— ë©”ëª¨ë¦¬ë¥¼ í• ë‹¹í•˜ê³ , í•´ë‹¹ ë©”ëª¨ë¦¬ì— ëŒ€í•œ í¬ì¸í„°ë¥¼ Existential Containerì˜ valueBuffer ë‚´ì— ì €ì¥í•œë‹¤.

2ï¸âƒ£ copy
![](https://i.imgur.com/ftXOE9U.png)

ë¡œì»¬ ë³€ìˆ˜ë¥¼ ì´ˆê¸°í™” í•˜ëŠ” ì†ŒìŠ¤ì—ì„œ Existential Containerë¡œ ê°’ì„ ë³µì‚¬ í•´ì•¼í•œë‹¤.
(Pointì™€ ê°™ì´ valueBufferì— ë“¤ì–´ë§ëŠ” íƒ€ì…ì€ valueBuffer ë‚´ì— ê°’ì„ ì €ì¥í•˜ê¸° ë•Œë¬¸ì—, copy ë¶€ë¶„ì—ì„œ Existential Containerë¡œ ê°’ì„ ë³µì‚¬í•¨)
Lineì€ valueBufferì— ë“¤ì–´ë§ì§€ ì•Šê¸° ë•Œë¬¸ì— copyì—ì„œ Heapì— ê°’ì´ ë³µì‚¬ëœë‹¤.

3ï¸âƒ£ destruct
![](https://i.imgur.com/cIYOHjS.png)

local ë³€ìˆ˜ë¥¼ ë‹¤ ì¨ì„œ lifetimeì´ ëë‚˜ë©´ SwiftëŠ” VWTì—ì„œ destructë¥¼ í˜¸ì¶œí•œë‹¤.
destructëŠ” ê°’ì— ëŒ€í•œ ë ˆí¼ëŸ°ìŠ¤ ì¹´ìš´íŠ¸ë¥¼ ê°ì†Œì‹œí‚¨ë‹¤.

4ï¸âƒ£ deallocate
![](https://i.imgur.com/RkoFRno.png)

ê·¸ë¦¬ê³  deallocateì„ í˜¸ì¶œí•˜ì—¬ Lineì´ Heap ë©”ëª¨ë¦¬ í• ë‹¹ì„ í•´ì œí•œë‹¤.

vwtì—ì„œëŠ” ì €ì¥ í”„ë¡œí¼í‹°ë¥¼ ê´€ë¦¬í•˜ê³ , pwtì—ì„œëŠ” í”„ë¡œí† ì½œ ë©”ì„œë“œë¥¼ ê´€ë¦¬í•œë‹¤.

*** SwiftëŠ” existential container í•„ë“œì—ì„œ pwtë¥¼ ì¡°íšŒí•˜ê³ , í•´ë‹¹ tableì˜ fixed offsetì— ìˆëŠ” ë©”ì„œë“œë¥¼ ì¡°íšŒí•˜ì—¬ êµ¬í˜„ìœ¼ë¡œ ì´ë™í•œë‹¤ ***

## ğŸ“Œ Generic Code

Generic CodeëŠ” staticí•œ í˜•íƒœì˜ polymorphismì„ ì§€ì›í•œë‹¤.
staticí•œ í˜•íƒœì˜ polymorphismì€ Genericì˜ specializationì´ë¼ê³  ë¶ˆë¦¬ëŠ” ì»´íŒŒì¼ëŸ¬ ìµœì í™”ë¥¼ ê°€ëŠ¥í•˜ê²Œ í•œë‹¤.
![](https://i.imgur.com/IULWU4V.png)

drawACopyì—ì„œ Pointë¥¼ íŒŒë¼ë¯¸í„°ë¡œ í˜¸ì¶œí•˜ë©´
SwiftëŠ” í•´ë‹¹ íƒ€ì…ì„ ì‚¬ìš©í•˜ì—¬ í•¨ìˆ˜ì—ì„œ Generic ë§¤ê°œë³€ìˆ˜ë¥¼ ëŒ€ì²´í•˜ê³ , í•´ë‹¹ íƒ€ì… ë²„ì „ì˜ í•¨ìˆ˜ë¥¼ ë§Œë“ ë‹¤.
Lineì„ íŒŒë¼ë¯¸í„°ë¡œ í˜¸ì¶œí•˜ë©´ Line ë²„ì „ì˜ drawACopyê°€ ìƒê¸´ë‹¤.

![](https://i.imgur.com/240i9jq.png)

íƒ€ì…ë§ˆë‹¤ í•´ë‹¹ í•¨ìˆ˜ì˜ ë²„ì „ì„ ë§Œë“¤ê¸° ë•Œë¬¸ì— code sizeë¥¼ ì¦ê°€ì‹œí‚¬ ê°€ëŠ¥ì„±ì´ ìˆë‹¤.
í•˜ì§€ë§Œ aggressive compiler optimizationì´ ê°€ëŠ¥í•˜ê¸° ë•Œë¬¸ì— ì‹¤ì œë¡œëŠ” Swiftê°€ code sizeë¥¼ ì¤„ì¼ ìˆ˜ ìˆë‹¤.
specializationì„ í†µí•´ existential containerê°€ í•„ìš” ì—†ì–´ì§€ê³  (í•´ë‹¹ íƒ€ì… ë²„ì „ìœ¼ë¡œ í•¨ìˆ˜ë¥¼ ë§Œë“¤ê¸° ë•Œë¬¸ì—, êµ³ì´ í•´ë‹¹ ë©”ì„œë“œê°€ ëˆ„êµ¬ê»€ì§€ ì €ì¥í•  pwtê°€ í•„ìš” ì—†ì–´ì§€ê¸° ë•Œë¬¸),
static dispatchê°€ ê°€ëŠ¥í•´ì§„ë‹¤.

ìµœì†Œí•œì˜ dynamic ëŸ°íƒ€ì„ ìš”êµ¬ì‚¬í•­ìœ¼ë¡œ ì í•©í•œ ì¶”ìƒí™” ì„ íƒ
- struct types: value semantics    
- class types: identity or OOP style polymorphism
- Generics: static polymorphism
- Protocol types: dynamic polymorphism
- í° ê°’ë“¤ì„ ì²˜ë¦¬í•  ë•ŒëŠ” indirect storage ì‚¬ìš©





